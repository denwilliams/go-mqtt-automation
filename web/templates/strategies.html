{{define "strategies-content"}}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
    <h2>Strategies</h2>
    <a href="/strategies/new" class="btn btn-primary">Create New Strategy</a>
</div>

{{if .Strategies}}
<div class="card">
    <div class="card-body">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Language</th>
                    <th>Code Preview</th>
                    <th>Created</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {{range $id, $strategy := .Strategies}}
                <tr>
                    <td><strong>{{$strategy.Name}}</strong></td>
                    <td><span class="topic-type topic-type-system">{{$strategy.Language}}</span></td>
                    <td>
                        <code style="max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; display: block;">
                            {{if gt (len $strategy.Code) 80}}
                            {{slice $strategy.Code 0 80}}...
                            {{else}}
                            {{$strategy.Code}}
                            {{end}}
                        </code>
                    </td>
                    <td>{{$strategy.CreatedAt.Format "2006-01-02"}}</td>
                    <td>
                        <a href="/strategies/edit/{{$id}}" class="btn btn-secondary btn-sm">Edit</a>
                        <form method="post" action="/strategies/delete/{{$id}}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this strategy? This may break topics that use it.')">
                            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                        </form>
                    </td>
                </tr>
                {{end}}
            </tbody>
        </table>
    </div>
</div>
{{else}}
<div class="card">
    <div class="card-body">
        <p>No strategies found. <a href="/strategies/new">Create your first strategy</a>.</p>
        <p>Strategies define the logic for processing topic inputs and generating outputs. They are written in JavaScript and can perform calculations, comparisons, and emit events to other topics.</p>
    </div>
</div>
{{end}}

<div class="card" style="margin-top: 2rem;">
    <div class="card-header">
        <h3>Strategy Examples</h3>
    </div>
    <div class="card-body">
        <h4>Simple Passthrough</h4>
        <pre class="code-editor" style="min-height: auto;">function process(context) {
    // Pass through the first input value
    const keys = Object.keys(context.inputs);
    if (keys.length > 0) {
        return context.inputs[keys[0]];
    }
    return null;
}</pre>

        <h4>Temperature Average</h4>
        <pre class="code-editor" style="min-height: auto;">function process(context) {
    const temps = Object.values(context.inputs).filter(v => v !== null && !isNaN(v));
    if (temps.length === 0) return null;
    
    const average = temps.reduce((a, b) => a + b, 0) / temps.length;
    return Math.round(average * 10) / 10; // Round to 1 decimal
}</pre>

        <h4>Motion Detection</h4>
        <pre class="code-editor" style="min-height: auto;">function process(context) {
    const motionDetected = Object.values(context.inputs).some(v => v === true);
    
    if (motionDetected && !context.lastOutputs) {
        context.log("Motion detected!");
        context.emit("alerts/motion", { detected: true, time: context.getISO() });
    }
    
    return motionDetected;
}</pre>
    </div>
</div>
{{end}}